{% extends "base.html" %}
{% block title %}Expenses · Expense Tracker{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 mb-md-4 gap-2">
  <div>
    <div class="page-title">Expenses</div>
    <div class="page-subtitle">
      Browse, filter and export your expense history.
    </div>
  </div>
  <div class="d-flex flex-wrap gap-2">
    <a href="{% url 'expenses:expense_add' %}" class="btn btn-primary btn-sm">
      + Add expense
    </a>
    <a
      href="{% url 'expenses:expense_export_csv' %}?{{ request.GET.urlencode }}"
      class="btn btn-outline-secondary btn-sm"
    >
      Export CSV
    </a>
  </div>
</div>

<div class="card card-glass p-3 mb-3">
  <div class="d-flex justify-content-between align-items-center card-glass-header">
    <span class="metric-label">Filters</span>
    <button
      type="button"
      class="btn btn-sm btn-outline-secondary"
      onclick="window.location.href='{% url 'expenses:expense_list' %}'"
    >
      Clear
    </button>
  </div>

  <form method="get" class="row g-2">
    <div class="col-md-4">
      <label class="form-label mb-1 small text-uppercase text-secondary">Category</label>
      <select name="category" class="form-select">
        <option value="">All categories</option>
        {% for category in categories %}
          <option
            value="{{ category.id }}"
            {% if selected_category|default:'' == category.id|stringformat:'s' %}selected{% endif %}
          >
            {{ category.name }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label mb-1 small text-uppercase text-secondary">From</label>
      <input type="date" name="date_from" class="form-control" value="{{ date_from }}">
    </div>
    <div class="col-md-3">
      <label class="form-label mb-1 small text-uppercase text-secondary">To</label>
      <input type="date" name="date_to" class="form-control" value="{{ date_to }}">
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button type="submit" class="btn btn-primary w-100">
        Apply
      </button>
    </div>
  </form>
</div>

<div class="card card-glass p-3">
  <div class="table-responsive">
    <table class="table table-modern table-striped align-middle mb-0">
      <thead>
      <tr>
        <th>Date</th>
        <th>Category</th>
        <th>Description</th>
        <th class="text-end">Amount</th>
        <th class="text-end">Actions</th>
      </tr>
      </thead>
      <tbody>
      {% for expense in expenses %}
        <tr>
          <td>{{ expense.date }}</td>
          <td>{{ expense.category|default:"(No category)" }}</td>
          <td class="text-truncate" style="max-width: 260px;">
            {{ expense.description }}
          </td>
          <td class="text-end">
            {{ expense.amount|floatformat:2 }} {{ USER_CURRENCY_SYMBOL }}
          </td>
          <td class="text-end">
            <a href="{% url 'expenses:expense_edit' expense.pk %}" class="btn btn-sm btn-outline-secondary me-1">
              Edit
            </a>
            <a href="{% url 'expenses:expense_delete' expense.pk %}" class="btn btn-sm btn-outline-secondary">
              Delete
            </a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="5" class="text-center py-4">
            No expenses found. Try adjusting filters or add a new expense.
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  {% if expenses.paginator.num_pages > 1 %}
  <div class="mt-3 d-flex justify-content-center">
    <nav>
      <ul class="pagination mb-0">
        {% if expenses.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ expenses.previous_page_number }}&{{ request.GET.urlencode|cut:'page='|safe }}">
              ‹ Prev
            </a>
          </li>
        {% endif %}
        <li class="page-item disabled">
          <span class="page-link">
            Page {{ expenses.number }} of {{ expenses.paginator.num_pages }}
          </span>
        </li>
        {% if expenses.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ expenses.next_page_number }}&{{ request.GET.urlencode|cut:'page='|safe }}">
              Next ›
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>
  {% endif %}
</div>
{% endblock %}
